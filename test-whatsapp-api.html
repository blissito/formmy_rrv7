<!DOCTYPE html>
<html>
<head>
  <title>Test WhatsApp API</title>
</head>
<body>
  <h1>Test WhatsApp API</h1>

  <div>
    <label>Chatbot ID:</label>
    <input type="text" id="chatbotId" placeholder="Pega el chatbot ID aquí">
    <button onclick="testIntegration()">Test Integration API</button>
  </div>

  <div style="margin-top: 20px;">
    <h3>Integration API Response:</h3>
    <pre id="integrationResult" style="background: #f5f5f5; padding: 10px;"></pre>
  </div>

  <div style="margin-top: 20px;">
    <label>Integration ID:</label>
    <input type="text" id="integrationId" placeholder="Se llenará automáticamente">
    <button onclick="testSync()">Test Sync API</button>
  </div>

  <div style="margin-top: 20px;">
    <h3>Sync API Response:</h3>
    <pre id="syncResult" style="background: #f5f5f5; padding: 10px;"></pre>
  </div>

  <script>
    async function testIntegration() {
      const chatbotId = document.getElementById('chatbotId').value;
      const result = document.getElementById('integrationResult');

      if (!chatbotId) {
        result.textContent = 'Error: Ingresa un chatbot ID';
        return;
      }

      try {
        const response = await fetch(`https://formmy.app/api/v1/integration?chatbotId=${chatbotId}`, {
          credentials: 'include'
        });

        const data = await response.json();
        result.textContent = JSON.stringify(data, null, 2);

        // Si encontramos una integración de WhatsApp, llenar el integration ID
        const whatsappIntegration = data.integrations?.find(i => i.platform === 'WHATSAPP');
        if (whatsappIntegration) {
          document.getElementById('integrationId').value = whatsappIntegration.id;
        }
      } catch (error) {
        result.textContent = 'Error: ' + error.message;
      }
    }

    async function testSync() {
      const integrationId = document.getElementById('integrationId').value;
      const result = document.getElementById('syncResult');

      if (!integrationId) {
        result.textContent = 'Error: Ingresa un integration ID';
        return;
      }

      try {
        const response = await fetch(`https://formmy.app/api/v1/integrations/whatsapp/sync?integrationId=${integrationId}`, {
          credentials: 'include'
        });

        const data = await response.json();
        result.textContent = JSON.stringify(data, null, 2);
      } catch (error) {
        result.textContent = 'Error: ' + error.message;
      }
    }
  </script>
</body>
</html>
